# redis 复制的核心机制

1. 第一次才进行的全量复制
   1. 维护有offset，代表已经复制了多少数据了。 
2. backlog master 有backlog 主要用户全量复制的时候中断的增量复制的。 大小默认是1M
3. run ID来区分不同的master，而不是根据IP和端口，如果run ID发生变化才使用全量复制。
4. psync 根据自身的情况来判断是全量复制还是增量复制



## 全量复制

	1. master 进行bgsave 
 	2. 发送rdb 给对应的slave node 如果超过了60M的话会认为发送失败。
 	3. 在发送rdb,会有内存队列来保存新的命令，然后发送给slave node。
 	4. 如果内存缓冲队列超过一次性256M或者超过64M，会认为复制失败
 	5. 接收到rdb 文件以后salve node 如果使用AOF 了，就会重写aof



## 增量复制

1. 从backlog 中发送增量数据。 

异步复制。就是接收到新的命令以后再异步复制新增的数据。 