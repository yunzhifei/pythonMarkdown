# 深入理解kafka

## 	kafka如何复制

​		broker 有一个唯一标识符(id)可以指定，也可以自动生成。通过注册到zookeeper下临时节点。来通知集群，有新加或者节点退出。

​		控制器就是一个特殊的broker，除了正常的broker，还有分区首领的选举功能。通过在/Controller 下面创建临时节点来成为控制器。当有broker挂掉的时候，控制器会知道，然后如果有分区首领在这个broker上，就获取分区副本的下一个分区副本成为新的分区首领。

​		控制器通过epoch来避免脑裂。

​		副本有两种类型：

​			1. 首领副本

   			2. 跟随者副本



​		跟随者只会从首领副本获取消息，如果跟随者副本在10s内，没有请求最新消息或者没有请求消息。他就不可能在首领副本失效的时候成为新的首领，反之持续同步的就是同步副本。只有同步副本才可能成为新的首领。

​		首选首领：创建主题的时候指定的首领就是首选首领。希望在首选首领成为分区首领的情况下，负载是基本均衡的。

## 	kafaka如何处理消费者和生产者的请求	

​		因为所有的生产请求和消费请求都必须发送到首领副本，客户端就必须知道每一个分区的首领副本对应的broker。通过发送元数据请求来获取这些元数据信息。

## 	kafka存储细节

​	