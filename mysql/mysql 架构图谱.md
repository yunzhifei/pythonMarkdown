# mysql 架构图谱

 	1. MySQL的内部整体架构![MySQL基础架构](../images/MySQL基础架构.png)
     所有跨存储引擎的东西都在解析器和优化器这一层。跨存储引擎的都是接口实现的。存储引擎在不同的系统中是不一样的。存储引擎只是简单的处理服务器的请求。存储引擎除了innodb之外都不会解析sql，innodb也只是解析外键的定义。
 	2. 链接和安全性
      - 服务器会缓存线程的管理。不会为每一个新建的链接新建或者销毁线程的
      - 而且链接成功以后会检查特定sql的执行权限。
	3. 锁策略
    - 锁策略的主要解决问题就是在锁的开销和数据的安全性之间的权衡。
    - 表锁
    - 行锁
	4. 事务的隔离级别
    - Read uncommitted 读未提交
    - read commited 读提交
    - repeatable read 可重复读(默认的隔离级别) 会有幻影读取(一个事务在读取ID 从1-20的数据，另外一个事务插入了一个id=10的数据就发生了幻影读)，MVCC解决了这个问题。
    - serializable 可串行化
	5. 死锁
    - 当不同的事务按照不同的顺序请求不同的锁就可能发生死锁行为。Inodb的处理死锁办法是，把持有最少行业排他锁的事务回滚。而且innodb可以检测到死锁并抛出一个错误。
    - 锁的行为和顺序是和存储引擎有关的。
	6. 事务日志
    - 事务日志先写入到磁盘然后修改的数据慢慢刷新会到磁盘就可以了，预写式日志。这样修改数据就需要写两次磁盘了。不过日志是追加方式顺序写磁盘很快的。
    - ![MySQL修改数据过程](../images/MySQL修改数据过程.png)
	7. MySQL中的事务
    - MySQL提供两种事务引擎Innodb 和NDB cluster

